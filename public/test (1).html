<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  <script src="script/pixi.min.js"></script>

  <p>Hello</p>
  <script>
    let type = "WebGL"
    if (!PIXI.utils.isWebGLSupported()) {
      type = "canvas"
    }

    PIXI.utils.sayHello(type);

    //Create a Pixi Application
    let app = new PIXI.Application({ width: 690, height: 550 });

    //Add the canvas that Pixi automatically created for you to the HTML document
    document.body.appendChild(app.view);

    // images
    // background1
    let container = new PIXI.Container();
    app.stage.addChild(container);

    var texture = PIXI.Texture.fromImage('images/fishcook_background.png');
    var background = new PIXI.Sprite(texture);
    background.width = 550;
    background.x = 0;
    background.y = 230;
    container.addChild(background);
    // app.stage.addChild(taiyaki);

    var background1 = new PIXI.Graphics();
    background1.beginFill(0xEAC067);
    background1.drawRect(0, 0, 690, 220);
    background1.endFill();
    background1.x = 0;
    background1.y = 0;
    app.stage.addChild(background1);

    var background2 = new PIXI.Graphics();
    background2.beginFill(0xAA6A01);
    background2.drawRect(0, 0, 15, 220);
    background2.endFill();
    background2.x = 40;
    background2.y = 0;
    app.stage.addChild(background2);

    var background3 = new PIXI.Graphics();
    background3.beginFill(0xAA6A01);
    background3.drawRect(0, 0, 15, 220);
    background3.endFill();
    background3.x = 140;
    background3.y = 0;
    app.stage.addChild(background3);

    var background4 = new PIXI.Graphics();
    background4.beginFill(0xAA6A01);
    background4.drawRect(0, 0, 15, 220);
    background4.endFill();
    background4.x = 240;
    background4.y = 0;
    app.stage.addChild(background4);

    var background5 = new PIXI.Graphics();
    background5.beginFill(0xAA6A01);
    background5.drawRect(0, 0, 15, 220);
    background5.endFill();
    background5.x = 340;
    background5.y = 0;
    app.stage.addChild(background5);

    var background6 = new PIXI.Graphics();
    background6.beginFill(0xAA6A01);
    background6.drawRect(0, 0, 15, 220);
    background6.endFill();
    background6.x = 440;
    background6.y = 0;
    app.stage.addChild(background6);

    var background7 = new PIXI.Graphics();
    background7.beginFill(0xAA6A01);
    background7.drawRect(0, 0, 15, 220);
    background7.endFill();
    background7.x = 540;
    background7.y = 0;
    app.stage.addChild(background7);

    var background8 = new PIXI.Graphics();
    background8.beginFill(0xAA6A01);
    background8.drawRect(0, 0, 15, 220);
    background8.endFill();
    background8.x = 640;
    background8.y = 0;
    app.stage.addChild(background8);

    var texture = PIXI.Texture.fromImage('images/shopbackground.png');
    var background9 = new PIXI.Sprite(texture);
    background9.width = 345;
    background9.height = 80;
    app.stage.addChild(background9);

    var texture = PIXI.Texture.fromImage('images/shopbackground.png');
    var background10 = new PIXI.Sprite(texture);
    background10.width = 345;
    background10.height = 80;
    background10.x = 345;
    app.stage.addChild(background10);

    // red bar
    var rectangle = new PIXI.Graphics();
    rectangle.beginFill(0xE84C09);
    rectangle.drawRect(0, 0, 690, 25);
    rectangle.endFill();
    rectangle.x = 0;
    rectangle.y = 220;
    app.stage.addChild(rectangle);

    // panel
    var texture = PIXI.Texture.fromImage('images/panel.png');
    var background11 = new PIXI.Sprite(texture);
    background11.x = 505;
    background11.y = 65;
    app.stage.addChild(background11);

    // panel_scoreText
    // Text style
    var style = new PIXI.TextStyle({
      align: 'center',
      fontWeight: 'bold'
    });
    var score = 0;
    var scoreText = new PIXI.Text(score, style);
    scoreText.position.set(550, 160)
    app.stage.addChild(scoreText);

    // life1
    var texture = PIXI.Texture.fromImage('images/life.gif');
    var life1 = new PIXI.Sprite(texture);
    life1.scale.set(1.7);
    life1.position.set(530, 110)
    app.stage.addChild(life1);

    // life2
    var texture = PIXI.Texture.fromImage('images/life.gif');
    var life2 = new PIXI.Sprite(texture);
    life2.scale.set(1.7);
    life2.position.set(555, 110)
    app.stage.addChild(life2);

    // life3
    var texture = PIXI.Texture.fromImage('images/life.gif');
    var life3 = new PIXI.Sprite(texture);
    life3.scale.set(1.7);
    life3.position.set(580, 110)
    app.stage.addChild(life3);

    // life4
    var texture = PIXI.Texture.fromImage('images/life.gif');
    var life4 = new PIXI.Sprite(texture);
    life4.scale.set(1.7);
    life4.position.set(605, 110)
    app.stage.addChild(life4);

    // life5
    var texture = PIXI.Texture.fromImage('images/life.gif');
    var life5 = new PIXI.Sprite(texture);
    life5.scale.set(1.7);
    life5.position.set(630, 110)
    app.stage.addChild(life5);

    // characters
    // boy_wating with speech bubble
    var texture = PIXI.Texture.fromImage('images/boy_waiting.png');
    var boy = new PIXI.Sprite(texture);
    boy.scale.set(0.5);
    boy.position.set(20, 57);
    app.stage.addChild(boy);

    // girl_wating with speech bubble * VIP added later
    var texture = PIXI.Texture.fromImage('images/girl_waiting.png');
    var girl = new PIXI.Sprite(texture);
    girl.scale.set(0.5);
    girl.position.set(260, 57);
    app.stage.addChild(girl);

    // speech_bubble1
    var texture = PIXI.Texture.fromImage('images/speech_bubble_left.png');
    var speech_bubble_left1 = new PIXI.Sprite(texture);
    speech_bubble_left1.scale.set(0.3);
    speech_bubble_left1.height = 100;
    speech_bubble_left1.position.set(145, 15);
    app.stage.addChild(speech_bubble_left1);

    // speech_bubble2
    var texture = PIXI.Texture.fromImage('images/speech_bubble_left.png');
    var speech_bubble_left2 = new PIXI.Sprite(texture);
    speech_bubble_left2.scale.set(0.3);
    speech_bubble_left2.height = 100;
    speech_bubble_left2.position.set(390, 15);
    app.stage.addChild(speech_bubble_left2);

    // speech_bubble1_text
    var style = new PIXI.TextStyle({
      align: 'center',
      fontWeight: 'bold',
      fontSize : 15
    });
    // random(1~6)
    var requestAmount1 = Math.floor((Math.random() * 6) + 1);
    var speech_bubble1_text1 = new PIXI.Text("たい焼き"+ requestAmount1 + " 個", style);
    var speech_bubble1_text2 = new PIXI.Text("ください!", style);
    speech_bubble1_text1.position.set(168, 50);
    speech_bubble1_text2.position.set(168, 70);
    app.stage.addChild(speech_bubble1_text1);
    app.stage.addChild(speech_bubble1_text2);

    // speech_bubble2_text
    var requestAmount2 = Math.floor((Math.random() * 6) + 1);
    var speech_bubble1_text3 = new PIXI.Text("たい焼き"+ requestAmount2 + " 個", style);
    var speech_bubble1_text4 = new PIXI.Text("ください!", style);
    speech_bubble1_text3.position.set(410, 50);
    speech_bubble1_text4.position.set(410, 70);
    app.stage.addChild(speech_bubble1_text3);
    app.stage.addChild(speech_bubble1_text4);






   


    // taiyaki_1~9
    // taiyaki1
    var texture = PIXI.Texture.fromImage('images/fish_empty1.png');
    var taiyaki1 = new PIXI.Sprite(texture);
    taiyaki1.scale.set(0.25);
    taiyaki1.x = 20;
    taiyaki1.y = 240;
    app.stage.addChild(taiyaki1);

    // taiyaki2
    var texture = PIXI.Texture.fromImage('images/fish_empty1.png');
    var taiyaki2 = new PIXI.Sprite(texture);
    taiyaki2.scale.set(0.25);
    taiyaki2.x = 20;
    taiyaki2.y = 340;
    app.stage.addChild(taiyaki2);

    // taiyaki3
    var texture = PIXI.Texture.fromImage('images/fish_empty1.png');
    var taiyaki3 = new PIXI.Sprite(texture);
    taiyaki3.scale.set(0.25);
    taiyaki3.x = 20;
    taiyaki3.y = 440;
    app.stage.addChild(taiyaki3);

    // taiyaki4
    var texture = PIXI.Texture.fromImage('images/fish_empty1.png');
    var taiyaki4 = new PIXI.Sprite(texture);
    taiyaki4.scale.set(0.25);
    taiyaki4.x = 190;
    taiyaki4.y = 240;
    app.stage.addChild(taiyaki4);

    // taiyaki5
    var texture = PIXI.Texture.fromImage('images/fish_empty1.png');
    var taiyaki5 = new PIXI.Sprite(texture);
    taiyaki5.scale.set(0.25);
    taiyaki5.x = 190;
    taiyaki5.y = 340; // + 100
    app.stage.addChild(taiyaki5);

    // taiyaki6
    var texture = PIXI.Texture.fromImage('images/fish_empty1.png');
    var taiyaki6 = new PIXI.Sprite(texture);
    taiyaki6.scale.set(0.25);
    taiyaki6.x = 190;
    taiyaki6.y = 440; // + 100
    app.stage.addChild(taiyaki6);

    // taiyaki7
    var texture = PIXI.Texture.fromImage('images/fish_empty1.png');
    var taiyaki7 = new PIXI.Sprite(texture);
    taiyaki7.scale.set(0.25);
    taiyaki7.x = 360; // + 170
    taiyaki7.y = 240;
    app.stage.addChild(taiyaki7);

    // taiyaki8
    var texture = PIXI.Texture.fromImage('images/fish_empty1.png');
    var taiyaki8 = new PIXI.Sprite(texture);
    taiyaki8.scale.set(0.25);
    taiyaki8.x = 360;
    taiyaki8.y = 340;
    app.stage.addChild(taiyaki8);

    // taiyaki9
    var texture = PIXI.Texture.fromImage('images/fish_empty1.png');
    var taiyaki9 = new PIXI.Sprite(texture);
    taiyaki9.scale.set(0.25);
    taiyaki9.x = 360;
    taiyaki9.y = 440;
    app.stage.addChild(taiyaki9);

    // ingredient space
    var rectangle1 = new PIXI.Graphics();
    rectangle1.beginFill(0x7ED824);
    rectangle1.drawRect(0, 0, 140, 280);
    rectangle1.endFill();
    rectangle1.x = 550;
    rectangle1.y = 245;
    app.stage.addChild(rectangle1);

    // Anko
    var texture = PIXI.Texture.fromImage('images/ingredients2.png');
    var anko = new PIXI.Sprite(texture);
    anko.scale.set(0.2);
    anko.x = 580;
    anko.y = 325;
    app.stage.addChild(anko);

    // hand
    var texture = PIXI.Texture.fromImage('images/hand.png');
    var hand = new PIXI.Sprite(texture);
    hand.scale.set(1.2);
    hand.x = 580;
    hand.y = 410;
    app.stage.addChild(hand);

    // trash
    var texture = PIXI.Texture.fromImage('images/trash.png');
    var trash = new PIXI.Sprite(texture);
    trash.x = 530;
    trash.y = 465;
    trash.width = 200;
    app.stage.addChild(trash);

    // create a texture from an image path
    var texture = PIXI.Texture.fromImage('images/ingredients1.png');

    // Scale mode for pixelation
    texture.baseTexture.scaleMode = PIXI.SCALE_MODES.NEAREST;

    // Create
    create(
      640, 305
    );

    function create(x, y) {
      var ingredients1 = new PIXI.Sprite(texture);

      ingredients1.interactive = true;

      ingredients1.buttonMode = true;

      ingredients1.anchor.set(0.7);

      ingredients1.scale.set(0.22);

      ingredients1
        .on('mousedown', onDragStart)
        .on('mouseup', onDragEnd)
        .on('mouseupoutside', onDragEnd)
        .on('mousemove', onDragMove);

      ingredients1.x = x;
      ingredients1.y = y;

      // add it to the stage
      app.stage.addChild(ingredients1);
    }

    function onDragStart(event) {
      // store a reference to the data
      // the reason for this is because of multitouch
      // we want to track the movement of this particular touch
      this.data = event.data;
      this.alpha = 0.5;
      this.dragging = true;
    }

    function onDragEnd() {
      this.alpha = 1;
      // 기울기 되돌리기
      this.rotation = 0.0;
      // Collision Detection
      if (hitTestRectangle(this, background)) {

        //if there's a collision
        console.log("Collsion");

        // change images
        var texture = PIXI.Texture.fromImage('images/taiyaki1.png');
        var taiyaki1 = new PIXI.Sprite(texture);
        taiyaki1.scale.set(1);
        taiyaki1.x = 100;
        taiyaki1.y = 300;

        // add it to the stage
        app.stage.addChild(taiyaki1);
      }

      // 나중에 this(해당 붕어빵)으로 수정
      if (hitTestRectangle(this, trash)) {
        console.log("Collsion");

        // remove image -> 안 보이게 처리
        this.visible = false;
      }

      // 원래 위치로
      this.x = 640;
      this.y = 305;
      this.dragging = false;
      // set the interaction data to null
      this.data = null;
    }

    function onDragMove() {
      if (this.dragging) {
        var newPosition = this.data.getLocalPosition(this.parent);
        this.rotation = -0.8;
        this.x = newPosition.x;
        this.y = newPosition.y;
      }
    }

    // Collision Detection
    function hitTestRectangle(r1, r2) {

      //Define the variables we'll need to calculate
      let hit, combinedHalfWidths, combinedHalfHeights, vx, vy;

      //hit will determine whether there's a collision
      hit = false;

      //Find the center points of each sprite
      r1.centerX = r1.x + r1.width / 2;
      r1.centerY = r1.y + r1.height / 2;
      r2.centerX = r2.x + r2.width / 2;
      r2.centerY = r2.y + r2.height / 2;

      //Find the half-widths and half-heights of each sprite
      r1.halfWidth = r1.width / 2;
      r1.halfHeight = r1.height / 2;
      r2.halfWidth = r2.width / 2;
      r2.halfHeight = r2.height / 2;

      //Calculate the distance vector between the sprites
      vx = r1.centerX - r2.centerX;
      vy = r1.centerY - r2.centerY;

      //Figure out the combined half-widths and half-heights
      combinedHalfWidths = r1.halfWidth + r2.halfWidth;
      combinedHalfHeights = r1.halfHeight + r2.halfHeight;

      //Check for a collision on the x axis
      if (Math.abs(vx) < combinedHalfWidths) {

        //A collision might be occurring. Check for a collision on the y axis
        if (Math.abs(vy) < combinedHalfHeights) {

          //There's definitely a collision happening
          hit = true;
        } else {

          //There's no collision on the y axis
          hit = false;
        }
      } else {

        //There's no collision on the x axis
        hit = false;
      }

      //`hit` will be either `true` or `false`
      return hit;
    };













  </script>

</body>

</html>